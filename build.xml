<project name="mgdb" default="deploy" basedir=".">
    
    <property file="build.properties" />

    <path id="classpath">
        <fileset dir="./">
            <include name="${srclib}/*.jar" />
        </fileset>
    </path>

    <!--make directories-->
    <target name="init">
        <tstamp/>
        <mkdir dir="${classesdir}"/>
        <mkdir dir="${destdir}/WEB-INF/classes"/>
        <mkdir dir="${properties}"/>
        <mkdir dir="${destdir}/WEB-INF/lib/"/>
        <copy todir="${destdir}/WEB-INF/lib">
            <fileset dir="${srclib}"/>
        </copy>
    </target>

    <target name="compile" depends="init">
        <javac
            srcdir="${srcdir}"
            destdir="${classesdir}">
            <!-- Make sure you set your classpath! -->
            <classpath>
                <fileset dir="${srclib}" includes="*.jar"/>
                <fileset dir="${tomcat.home}/lib" includes="servlet-api.jar"/>
                <pathelement path="${classesdir}" />
            </classpath>
        </javac>

        <!--<javac classpathref="classpath" srcdir="src" destdir="${destdir}/WEB-INF/classes/" />-->
        <!--<copy file="${properties}/service.properties" todir="${destdir}/WEB-INF/classes/"/>-->
        <!--<copy file="${properties}/rdbm.properties" todir="${destdir}/WEB-INF/classes/"/>-->
    </target>

    <target name="build" depends="compile">
        <copy todir="${build.home}">
            <fileset dir="${resources.dir}" includes="**/*.properties, *.html, *.jsp, *.ftl"/>
        </copy>
        <mkdir dir="${build.home}"/>
        <mkdir dir="${build.home}/WEB-INF"/>
        <copy todir="${build.home}/WEB-INF">
            <fileset dir="." includes="${classesdir}/**,${srclib}/**" excludes="${classesdir}/driver/**"/>
        </copy>
        <copy todir="${build.home}/WEB-INF/${classesdir}">
            <fileset dir="${properties}"/>
        </copy>

        <copy file="web.xml" todir="${destdir}/WEB-INF"/>
        <copy file="${resources.dir}/index.html" tofile="${build.home}/index.html"/>
        <war destfile="${warfile}" basedir="${destdir}" needxmlfile="false"/>
    </target>


    <target name="deploy" depends="build">
        <echo message="Deploying to tomcat at ${tomcat_webapps}"/>
        <copy file="${warfile}" todir="${tomcat_webapps}" overwrite="yes"/>
    </target>
    
    <!-- This example dist target merely jars up the webapp files. -->
    <target name="submit" depends="clean">
        <jar destfile="${submit.jar}" basedir="." excludes="bin/**,${srclib}/**,classes/**,build/**">
        </jar>
    </target>
    
    <!-- This example dist target merely jars up the webapp files. -->
    <target name="dist" depends="build">
        <jar destfile="${warfile}" basedir="${build.home}">
        </jar>
    </target>
    
    <target name="clean">
        <delete file="${warfile}" />
        <delete file="${submit.jar}" />
        <delete dir="${destdir}"/>
    </target>
    
    <target name="undeploy">
        <delete file="${tomcat_webapps}/${warfile}" />
    </target>
</project>
